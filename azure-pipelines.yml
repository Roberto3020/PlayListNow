trigger:
- main

pool:
  name: MyAgent
  demands:
    - agent.os -equals Linux

name: 'MyAgentPipeline-Minimal'

steps:

# ============================================
# 1. Checkout code
# ============================================
- checkout: self
  displayName: 'Checkout code'

# ============================================
# 2. Restore .NET
# ============================================
- task: DotNetCoreCLI@2
  displayName: 'Restore backend'
  inputs:
    command: 'restore'
    projects: '**/*.csproj'

# ============================================
# 3. Build .NET
# ============================================
- task: DotNetCoreCLI@2
  displayName: 'Build backend'
  inputs:
    command: 'build'
    projects: '**/*.csproj'
    arguments: '--configuration Release'

# ============================================
# 4. Build Angular
# ============================================
- task: CmdLine@2
  displayName: 'Build Angular frontend'
  inputs:
    workingDirectory: 'WebUI'
    script: |
      npm install
      npm run build --prod
